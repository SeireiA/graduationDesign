{"version":3,"file":"drawingFormView.js","sources":["pages/drawing/view/drawingFormView.vue","D:/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvZHJhd2luZy92aWV3L2RyYXdpbmdGb3JtVmlldy52dWU"],"sourcesContent":["<script setup>\n\nimport {onLoad} from '@dcloudio/uni-app'\nimport {ref} from \"vue\";\nimport LoadingPageComponent from \"../../../components/loadingPageComponent.vue\";\nimport BackPreviousComponent from \"../../../components/backPreviousComponent.vue\";\nimport SubmitButtonComponent from \"../../../components/submitButtonComponent.vue\";\nimport {reqGetUploadWorkflowsComponentFile, reqGetWorkflowsInterface} from \"@/api/drawingWorkflows\";\nimport {getTokenValue} from \"@/store/token\";\nimport {reqSubmitTask} from \"@/api/drawingTask\";\nimport store from \"@/store\";\n\n\nconst obj = ref({\n  energy: undefined,\n  containers: [],\n  workflowsId: undefined,\n  workflowsName: ''\n})\n\nconst barTop = ref(0)\n\nconst barHeight = ref(0)\n\nconst isLoading = ref(true)\n\nconst handleGetWorkflowsInterface = async (id) => {\n  try {\n    isLoading.value = true\n    const {data} = await reqGetWorkflowsInterface(id);\n    obj.value = data\n  } catch (e) {\n    uni.showToast({icon: 'none', duration: 1000, title: e.msg});\n    uni.navigateBack()\n  } finally {\n    setTimeout(() => {\n      isLoading.value = false\n    }, 500)\n  }\n}\n\nconst handleSubmitTask = async () => {\n  for (let i = 0; i < obj.value.containers.length; i++) {\n    const item = obj.value.containers[i];\n    if (!item.nodeValue) {\n      uni.showToast({\n        title: item.tips,\n        icon: 'none',\n        duration: 4000\n      });\n      return;\n    }\n  }\n  const map = obj.value.containers.map(c => {\n    return {\n      nodeDigital: c.nodeDigital,\n      nodeKey: c.nodeKey,\n      nodeValue: c.nodeValue,\n    }\n  });\n  try {\n    uni.showLoading({\n      title: \"正在提交中\",\n      mask: true,\n    });\n    const {data} = await reqSubmitTask({\n      workflowsId: obj.value.workflowsId,\n      containers: map\n    });\n    await store.dispatch('fetchUserInfo')\n    uni.navigateTo({\n      url: '/pages/drawing/view/drawingExecutionView?taskId=' + data + '&workflowsId=' + obj.value.workflowsId.value,\n      animationType: 'pop-in',\n      animationDuration: 200\n    })\n  } catch (e) {\n    uni.showToast({\n      icon: 'none',\n      duration: 1500,\n      title: e.msg\n    });\n  } finally {\n    uni.hideLoading()\n  }\n}\n\nconst handleDeleteNodeData = (index) => {\n  obj.value.containers[index].nodeValue = ''\n  obj.value.containers[index].preview = ''\n}\n\nconst handleUploadVideo = (index) => {\n  uni.showActionSheet({\n    itemList: ['相册中选择'],\n    success: () => {\n      uni.chooseVideo({\n        count: 1,\n        success: res => {\n          if (res.size > 12 * 1024 * 1024) {\n            uni.showToast({\n              title: '视频超过了12MB,请重新选择',\n              icon: 'none',\n              duration: 4000\n            })\n            return;\n          }\n          upload(res.tempFilePath, index)\n        },\n        fail: {}\n      })\n    }\n  })\n}\n\nconst handleUploadImage = (index) => {\n  uni.showActionSheet({\n    itemList: ['相册中选择'],\n    success: () => {\n      uni.chooseImage({\n        count: 1,\n        success: res => {\n          if (res.tempFiles[0].size > 4 * 1024 * 1024) { // 判断图片大小是否超过2MB\n            uni.showToast({\n              title: '图片超过了4MB,请重新选择',\n              icon: 'none',\n              duration: 4000\n            })\n            return;\n          }\n          let file = res.tempFiles[0].path;\n          upload(file, index)\n        },\n        fail: {}\n      })\n    }\n  })\n}\n\nconst upload = (file, index) => {\n  console.log(file)\n  uni.showLoading({\n    title: \"正在上传中\",\n    mask: true,\n  });\n  uni.uploadFile({\n    url: reqGetUploadWorkflowsComponentFile(),\n    filePath: file,\n    name: 'file',\n    header: {\n      'Authorization': 'Bearer ' + getTokenValue()\n    },\n    success(res) {\n      const {data} = JSON.parse(res.data);\n      obj.value.containers[index].nodeValue = data.fileName\n      obj.value.containers[index].preview = data.preview\n      uni.hideLoading()\n    },\n    fail(e) {\n      console.log(e)\n      uni.hideLoading()\n      uni.showToast({\n        title: '上传资源失败',\n        icon: 'none',\n        duration: 4000\n      })\n    }\n  })\n}\n\nonLoad((option) => {\n  let menuButtonBoundingClientRect = uni.getMenuButtonBoundingClientRect();\n  barTop.value = menuButtonBoundingClientRect.top\n  barHeight.value = menuButtonBoundingClientRect.height\n  handleGetWorkflowsInterface(option.workflowsId)\n})\n\n</script>\n\n<template>\n  <BackPreviousComponent :bar-height=\"barHeight\" :bar-top=\"barTop\"/>\n  <LoadingPageComponent v-if=\"isLoading\"/>\n  <!--  操作表单页面-->\n\n  <view class=\"container\" v-show=\"!isLoading\">\n    <view class=\"forms\">\n      <view v-for=\"(item,index) in obj.containers\" :key=index>\n        <!--      视频-->\n        <view class=\"VideoUpload\" v-if=\"item.type==='VIDEO_UPLOAD'\">\n          <view class=\"VideoUploadTips\">\n            <uni-icons type=\"videocam\" size=\"35rpx\" color=\"white\"></uni-icons>\n            <view>{{ item.tips }}</view>\n          </view>\n          <view class=\"picturePreview\" v-if=\"item.nodeValue\">\n            <video :src=\"item.preview\"/>\n            <view @click=\"handleDeleteNodeData(index)\">\n              ×\n            </view>\n          </view>\n          <view class=\"ImageUploadBtn\" @click=\"handleUploadVideo(index)\" v-else>\n            上传视频\n          </view>\n        </view>\n        <!--      图片-->\n        <view class=\"ImageUpload\" v-if=\"item.type==='IMAGE_UPLOAD'\">\n          <view class=\"ImageUploadTips\">\n            <uni-icons type=\"image\" size=\"35rpx\" color=\"white\"></uni-icons>\n            <view>{{ item.tips }}</view>\n          </view>\n          <view class=\"picturePreview\" v-if=\"item.nodeValue\">\n            <image :src=\"item.preview\" mode=\"aspectFill\"/>\n            <view @click=\"handleDeleteNodeData(index)\">\n              ×\n            </view>\n          </view>\n          <view class=\"ImageUploadBtn\" @click=\"handleUploadImage(index)\" v-else>\n            上传图片\n          </view>\n        </view>\n        <!--      文本-->\n        <view class=\"TextPrompt\" v-if=\"item.type==='TEXT_PROMPT'\">\n          <view class=\"TextPromptTips\">\n            <uni-icons type=\"compose\" size=\"35rpx\" color=\"white\"></uni-icons>\n            <view>{{ item.tips }}</view>\n          </view>\n          <view>\n            <input v-model=\"item.nodeValue\" placeholder=\"请输入....\" type=\"text\" class=\"input\"/>\n          </view>\n        </view>\n      </view>\n    </view>\n    <SubmitButtonComponent :title=\"'快速生成 消耗'+obj.energy+'能量'\" @onClick=\"handleSubmitTask\"/>\n  </view>\n</template>\n\n\n<style scoped lang=\"scss\">\n.btn {\n  margin: 40rpx;\n  background: linear-gradient(120deg, rgb(250, 52, 54) 1%, rgb(186, 42, 107) 66.24%, rgb(184, 54, 189) 97.8%);;\n  animation: gradient 4s ease infinite;\n  background-size: 200% 200%;\n  padding: 30rpx;\n  border-radius: 20rpx;\n  color: white;\n\n  text-align: center;\n  font-size: 30rpx;\n\n}\n\n.container {\n  padding-bottom: 80rpx\n}\n\n.input {\n  background: #323232;\n  border: 1rpx solid #2b2b2b;\n  border-radius: 15rpx;\n  margin-top: 20rpx;\n  padding: 15rpx\n}\n\n\n.forms {\n  padding: 40rpx 40rpx 10vh;\n  padding-top: 10vh;\n}\n\n.TextPrompt {\n  background: #232323;\n  border-radius: 20rpx;\n  color: white;\n  padding: 20rpx;\n  font-size: 28rpx;\n  margin: 40rpx 0;\n}\n\n.VideoUpload {\n  background: #232323;\n  border-radius: 20rpx;\n  color: white;\n  padding: 20rpx;\n  font-size: 28rpx;\n  margin: 40rpx 0;\n}\n\n.ImageUpload {\n  background: #232323;\n  border-radius: 20rpx;\n  color: white;\n  padding: 20rpx;\n  font-size: 28rpx;\n  margin: 40rpx 0;\n}\n\n.VideoUploadTips {\n  display: flex;\n  align-items: center\n}\n\n.VideoUploadTips > view {\n  padding-left: 10rpx\n}\n\n.TextPromptTips {\n  display: flex;\n  align-items: center\n}\n\n.TextPromptTips > view {\n  padding-left: 10rpx\n}\n\n.ImageUploadTips {\n  display: flex;\n  align-items: center\n}\n\n.ImageUploadTips > view {\n  padding-left: 10rpx\n}\n\n.ImageUploadBtn {\n  background: #323232;\n  border-radius: 20rpx;\n  padding: 20rpx;\n  margin-top: 20rpx;\n  text-align: center\n}\n\n.picturePreview {\n  padding-top: 20rpx;\n  position: relative;\n  width: 200rpx\n}\n\n.picturePreview image {\n  border-radius: 20rpx;\n  width: 200rpx;\n  height: 200rpx;\n\n}\n\n.picturePreview video {\n  border-radius: 20rpx;\n  width: 200rpx;\n  height: 200rpx\n}\n\n.picturePreview view {\n  font-size: 40rpx;\n  position: absolute;\n  right: 5rpx;\n  top: 25rpx;\n  width: 60rpx;\n  height: 60rpx;\n  z-index: 2;\n  background: rgba(30, 30, 30, 0.73);\n  color: white;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  border-radius: 100%\n}\n\n\n.lottie {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n}\n\n.lottie > view {\n  padding-top: 15vh\n}\n\n.title {\n  text-align: center;\n  color: #919191;\n  font-size: 33rpx\n}\n</style>\n\n","import MiniProgramPage from 'E:/0/beifen/0/0Files/2025答辩/ts-ts/miniProgram/pages/drawing/view/drawingFormView.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","reqGetWorkflowsInterface","uni","reqSubmitTask","store","reqGetUploadWorkflowsComponentFile","getTokenValue","onLoad"],"mappings":";;;;;;;;;;;;;;AAIA,MAAM,uBAAuB,MAAW;AACxC,MAAM,wBAAwB,MAAW;AACzC,MAAM,wBAAwB,MAAW;;;;AAOzC,UAAM,MAAMA,cAAAA,IAAI;AAAA,MACd,QAAQ;AAAA,MACR,YAAY,CAAE;AAAA,MACd,aAAa;AAAA,MACb,eAAe;AAAA,IACjB,CAAC;AAED,UAAM,SAASA,cAAG,IAAC,CAAC;AAEpB,UAAM,YAAYA,cAAG,IAAC,CAAC;AAEvB,UAAM,YAAYA,cAAG,IAAC,IAAI;AAE1B,UAAM,8BAA8B,OAAO,OAAO;AAChD,UAAI;AACF,kBAAU,QAAQ;AAClB,cAAM,EAAC,KAAI,IAAI,MAAMC,qBAAwB,yBAAC,EAAE;AAChD,YAAI,QAAQ;AAAA,MACb,SAAQ,GAAG;AACVC,sBAAAA,MAAI,UAAU,EAAC,MAAM,QAAQ,UAAU,KAAM,OAAO,EAAE,IAAG,CAAC;AAC1DA,sBAAAA,MAAI,aAAc;AAAA,MACtB,UAAY;AACR,mBAAW,MAAM;AACf,oBAAU,QAAQ;AAAA,QACnB,GAAE,GAAG;AAAA,MACP;AAAA,IACH;AAEA,UAAM,mBAAmB,YAAY;AACnC,eAAS,IAAI,GAAG,IAAI,IAAI,MAAM,WAAW,QAAQ,KAAK;AACpD,cAAM,OAAO,IAAI,MAAM,WAAW,CAAC;AACnC,YAAI,CAAC,KAAK,WAAW;AACnBA,wBAAAA,MAAI,UAAU;AAAA,YACZ,OAAO,KAAK;AAAA,YACZ,MAAM;AAAA,YACN,UAAU;AAAA,UAClB,CAAO;AACD;AAAA,QACD;AAAA,MACF;AACD,YAAM,MAAM,IAAI,MAAM,WAAW,IAAI,OAAK;AACxC,eAAO;AAAA,UACL,aAAa,EAAE;AAAA,UACf,SAAS,EAAE;AAAA,UACX,WAAW,EAAE;AAAA,QACd;AAAA,MACL,CAAG;AACD,UAAI;AACFA,sBAAAA,MAAI,YAAY;AAAA,UACd,OAAO;AAAA,UACP,MAAM;AAAA,QACZ,CAAK;AACD,cAAM,EAAC,KAAI,IAAI,MAAMC,8BAAc;AAAA,UACjC,aAAa,IAAI,MAAM;AAAA,UACvB,YAAY;AAAA,QAClB,CAAK;AACD,cAAMC,YAAK,MAAC,SAAS,eAAe;AACpCF,sBAAAA,MAAI,WAAW;AAAA,UACb,KAAK,qDAAqD,OAAO,kBAAkB,IAAI,MAAM,YAAY;AAAA,UACzG,eAAe;AAAA,UACf,mBAAmB;AAAA,QACzB,CAAK;AAAA,MACF,SAAQ,GAAG;AACVA,sBAAAA,MAAI,UAAU;AAAA,UACZ,MAAM;AAAA,UACN,UAAU;AAAA,UACV,OAAO,EAAE;AAAA,QACf,CAAK;AAAA,MACL,UAAY;AACRA,sBAAAA,MAAI,YAAa;AAAA,MAClB;AAAA,IACH;AAEA,UAAM,uBAAuB,CAAC,UAAU;AACtC,UAAI,MAAM,WAAW,KAAK,EAAE,YAAY;AACxC,UAAI,MAAM,WAAW,KAAK,EAAE,UAAU;AAAA,IACxC;AAEA,UAAM,oBAAoB,CAAC,UAAU;AACnCA,oBAAAA,MAAI,gBAAgB;AAAA,QAClB,UAAU,CAAC,OAAO;AAAA,QAClB,SAAS,MAAM;AACbA,wBAAAA,MAAI,YAAY;AAAA,YACd,OAAO;AAAA,YACP,SAAS,SAAO;AACd,kBAAI,IAAI,OAAO,KAAK,OAAO,MAAM;AAC/BA,8BAAAA,MAAI,UAAU;AAAA,kBACZ,OAAO;AAAA,kBACP,MAAM;AAAA,kBACN,UAAU;AAAA,gBACxB,CAAa;AACD;AAAA,cACD;AACD,qBAAO,IAAI,cAAc,KAAK;AAAA,YAC/B;AAAA,YACD,MAAM,CAAE;AAAA,UAChB,CAAO;AAAA,QACF;AAAA,MACL,CAAG;AAAA,IACH;AAEA,UAAM,oBAAoB,CAAC,UAAU;AACnCA,oBAAAA,MAAI,gBAAgB;AAAA,QAClB,UAAU,CAAC,OAAO;AAAA,QAClB,SAAS,MAAM;AACbA,wBAAAA,MAAI,YAAY;AAAA,YACd,OAAO;AAAA,YACP,SAAS,SAAO;AACd,kBAAI,IAAI,UAAU,CAAC,EAAE,OAAO,IAAI,OAAO,MAAM;AAC3CA,8BAAAA,MAAI,UAAU;AAAA,kBACZ,OAAO;AAAA,kBACP,MAAM;AAAA,kBACN,UAAU;AAAA,gBACxB,CAAa;AACD;AAAA,cACD;AACD,kBAAI,OAAO,IAAI,UAAU,CAAC,EAAE;AAC5B,qBAAO,MAAM,KAAK;AAAA,YACnB;AAAA,YACD,MAAM,CAAE;AAAA,UAChB,CAAO;AAAA,QACF;AAAA,MACL,CAAG;AAAA,IACH;AAEA,UAAM,SAAS,CAAC,MAAM,UAAU;AAC9BA,oBAAAA,MAAY,MAAA,OAAA,iDAAA,IAAI;AAChBA,oBAAAA,MAAI,YAAY;AAAA,QACd,OAAO;AAAA,QACP,MAAM;AAAA,MACV,CAAG;AACDA,oBAAAA,MAAI,WAAW;AAAA,QACb,KAAKG,qBAAAA,mCAAoC;AAAA,QACzC,UAAU;AAAA,QACV,MAAM;AAAA,QACN,QAAQ;AAAA,UACN,iBAAiB,YAAYC,0BAAe;AAAA,QAC7C;AAAA,QACD,QAAQ,KAAK;AACX,gBAAM,EAAC,KAAI,IAAI,KAAK,MAAM,IAAI,IAAI;AAClC,cAAI,MAAM,WAAW,KAAK,EAAE,YAAY,KAAK;AAC7C,cAAI,MAAM,WAAW,KAAK,EAAE,UAAU,KAAK;AAC3CJ,wBAAAA,MAAI,YAAa;AAAA,QAClB;AAAA,QACD,KAAK,GAAG;AACNA,wBAAAA,MAAA,MAAA,OAAA,iDAAY,CAAC;AACbA,wBAAAA,MAAI,YAAa;AACjBA,wBAAAA,MAAI,UAAU;AAAA,YACZ,OAAO;AAAA,YACP,MAAM;AAAA,YACN,UAAU;AAAA,UAClB,CAAO;AAAA,QACF;AAAA,MACL,CAAG;AAAA,IACH;AAEAK,kBAAM,OAAC,CAAC,WAAW;AACjB,UAAI,+BAA+BL,oBAAI;AACvC,aAAO,QAAQ,6BAA6B;AAC5C,gBAAU,QAAQ,6BAA6B;AAC/C,kCAA4B,OAAO,WAAW;AAAA,IAChD,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC7KD,GAAG,WAAW,eAAe;"}