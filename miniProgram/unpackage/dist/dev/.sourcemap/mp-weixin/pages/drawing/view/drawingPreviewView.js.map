{"version":3,"file":"drawingPreviewView.js","sources":["pages/drawing/view/drawingPreviewView.vue","D:/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvZHJhd2luZy92aWV3L2RyYXdpbmdQcmV2aWV3Vmlldy52dWU"],"sourcesContent":["<template>\n  <LoadingPageComponent v-if=\"isLoading\"/>\n  <view v-show=\"!isLoading\">\n    <BackPreviousComponent :bar-top=\"barTop\" :bar-height=\"barHeight\"/>\n    <view class=\"container\" v-if=\"obj.resultType!=='MODEL'\">\n      <image class=\"preview\" mode=\"widthFix\" :src=\"obj.url\" @click=\"handlePreviewImage(obj.url)\"\n             v-if=\"obj.resultType==='IMAGE'\"/>\n      <video class=\"preview\" :src=\"obj.url\" v-if=\"obj.resultType==='VIDEO'||obj.resultType==='AUDIO'\"/>\n    </view>\n    <view v-else>\n      <xr-start disable-scroll\n                :url=\"obj.url\"\n                :width=\"renderWidth\"\n                :height=\"renderHeight\"\n                style=\"width: 100%;height: 90vh;margin-top: 180rpx\">\n      </xr-start>\n    </view>\n    <view class=\"suspension\">\n      <view>\n        <view class=\"operationView\">\n          <view @click=\"handleRebuild\">\n            <view>\n              <uni-icons type=\"reload\" size=\"40rpx\" color=\"#d5d5d5\"></uni-icons>\n            </view>\n            <view class=\"text\">\n              重新生成\n            </view>\n          </view>\n          <view @click=\"handleDeleteWorkflowsWorks\" v-if=\"obj.isCurrentUser\">\n            <view>\n              <uni-icons type=\"trash\" size=\"40rpx\" color=\"#d5d5d5\"></uni-icons>\n            </view>\n            <view class=\"text\">\n              删除作品\n            </view>\n          </view>\n          <view @click=\"handleDownloadFile(obj.url)\" v-if=\"obj.resultType!=='MODEL'\">\n            <view>\n              <uni-icons type=\"download\" size=\"40rpx\" color=\"#d5d5d5\"></uni-icons>\n            </view>\n            <view class=\"text\">\n              下载保存\n            </view>\n          </view>\n\n        </view>\n      </view>\n    </view>\n  </view>\n\n</template>\n\n<script setup>\nimport {ref} from 'vue'\nimport BackPreviousComponent from \"../../../components/backPreviousComponent.vue\";\nimport LoadingPageComponent from \"../../../components/loadingPageComponent.vue\";\nimport {onLoad} from '@dcloudio/uni-app'\nimport {reqDeleteWorkflowsWorks, reqGetWorkflowsWorks} from \"@/api/drawingWorks\";\n\nconst barTop = ref(0)\n\nconst barHeight = ref(0)\n\nconst isLoading = ref(false)\n\nconst renderWidth = ref(100)\n\nconst renderHeight = ref(100)\n\nconst obj = ref({\n  workflowsWorksId: undefined,\n  workflowsId: undefined,\n  url: '',\n  resultType: '',\n  isCurrentUser: false\n})\n\nconst handlePreviewImage = (url) => {\n  uni.previewImage({\n    urls: [url]\n  });\n}\n\nconst handleRebuild = () => {\n  uni.navigateTo({\n    url: '/pages/drawing/view/drawingDetailsView?workflowsId=' + obj.value.workflowsId,\n    animationType: 'pop-in',\n    animationDuration: 200\n  })\n\n}\n\nconst handleGetWorkflowsWorks = async (id) => {\n  try {\n    isLoading.value = true\n    const {data} = await reqGetWorkflowsWorks(id);\n\n    obj.value = data\n  } catch (e) {\n    console.log(e)\n  } finally {\n    setTimeout(() => {\n      isLoading.value = false\n    }, 1000)\n  }\n}\n\nconst handleDeleteWorkflowsWorks = async () => {\n  uni.showModal({\n    title: '提示',\n    content: '确定删除这个作品?',\n    success: async function (res) {\n      if (res.confirm) {\n        uni.showLoading({\n          title: '正在删除 ing~',\n          mask: true\n        });\n        try {\n          await reqDeleteWorkflowsWorks({\n            workflowsWorksId: obj.value.workflowsWorksId\n          })\n          uni.hideLoading();\n          uni.$emit(\"WORKFLOWS_WORKS:REFRESH\")\n          uni.showToast({\n            icon: 'none',\n            duration: 1000,\n            title: '删除成功'\n          });\n\n        } catch (e) {\n          console.log(e)\n        } finally {\n          setTimeout(() => {\n            uni.navigateBack()\n          }, 500)\n        }\n      }\n    }\n  });\n}\n\nconst handleSaveImage = (url) => {\n  uni.showLoading({\n    title: '请稍等',\n    mask: true\n  });\n  uni.downloadFile({\n    url: url,\n    success: function (res) {\n      uni.saveImageToPhotosAlbum({\n        filePath: res.tempFilePath,\n        success: function () {\n          uni.hideLoading();\n          uni.showToast({\n            title: '保存成功',\n            icon: 'none',\n            duration: 4000\n          })\n        },\n        fail(e) {\n          console.log(e)\n        },\n        complete() {\n          uni.hideLoading();\n        }\n      })\n    }\n  })\n}\n\nconst handleSaveMedia = (url) => {\n  uni.showLoading({\n    title: '请稍等',\n    mask: true\n  });\n  uni.downloadFile({\n    url: url,\n    success: function (res) {\n      uni.saveVideoToPhotosAlbum({\n        filePath: res.tempFilePath,\n        success: function (data) {\n          uni.hideLoading();\n          uni.showToast({\n            title: '保存成功',\n            icon: 'none',\n            duration: 4000\n          })\n        },\n        fail(e) {\n          console.log(e)\n        },\n        complete(res) {\n          uni.hideLoading(); //隐藏 loading 提示框\n        }\n      })\n    }\n  })\n}\n\nconst handleDownloadFile = (url) => {\n  uni.getSetting({\n    success(res) {\n      if (!res.authSetting['scope.writePhotosAlbum']) {\n        uni.authorize({\n          scope: 'scope.writePhotosAlbum',\n          success() {\n            if (obj.resultType !== 'IMAGE') {\n              handleSaveMedia(url)\n            } else\n              handleSaveImage(url)\n          }\n        })\n      } else {\n        handleSaveImage(url)\n      }\n    }\n  })\n}\n\n\n\n\nonLoad((option) => {\n  let menuButtonBoundingClientRect = uni.getMenuButtonBoundingClientRect();\n  barTop.value = menuButtonBoundingClientRect.top - 93\n  barHeight.value = menuButtonBoundingClientRect.height\n\n  const dpi = uni.getWindowInfo().pixelRatio\n  const width = uni.getWindowInfo().windowWidth\n  const height = uni.getWindowInfo().windowHeight\n  renderWidth.value = width * dpi\n  renderHeight.value = height * dpi\n  handleGetWorkflowsWorks(option.workflowsWorksId)\n\n})\n</script>\n\n\n<style scoped lang=\"scss\">\n.container {\n  display: flex;\n  justify-content: center;\n  align-items: flex-start;\n  margin-top: 180rpx;\n  padding: 20rpx\n}\n\n.share {\n  width: 100%;\n  height: 100%;\n  position: absolute;\n  z-index: 999;\n  left: 0;\n  top: 0;\n  background-color: unset;\n}\n\n.relative {\n  position: relative;\n}\n\n.suspension {\n  position: fixed;\n  bottom: 30rpx;\n  width: 100%;\n  z-index: 9999;\n}\n\nbutton[plain] {\n  border: 0\n}\n\n.suspension > view {\n  display: flex;\n  padding: 20rpx;\n  color: #d5d5d5\n}\n\n.operationView {\n  font-size: 24rpx;\n  background: #323232;\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 20rpx 30rpx;\n  border-radius: 40rpx;\n  text-align: center;\n}\n\n.operationView > view {\n  margin: 0 30rpx;\n}\n\n.text {\n  padding-top: 10rpx\n}\n\n.preview {\n  width: 100%;\n  border-radius: 15rpx\n}\n</style>\n","import MiniProgramPage from 'E:/0/beifen/0/0Files/2025答辩/ts-ts/miniProgram/pages/drawing/view/drawingPreviewView.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","uni","reqGetWorkflowsWorks","reqDeleteWorkflowsWorks","res","onLoad"],"mappings":"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"}