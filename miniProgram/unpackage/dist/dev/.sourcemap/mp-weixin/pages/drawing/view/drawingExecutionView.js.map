{"version":3,"file":"drawingExecutionView.js","sources":["pages/drawing/view/drawingExecutionView.vue","D:/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvZHJhd2luZy92aWV3L2RyYXdpbmdFeGVjdXRpb25WaWV3LnZ1ZQ"],"sourcesContent":["<template>\n  <BackPreviousComponent :bar-height=\"barHeight\" :bar-top=\"barTop\"/>\n  <view class=\"container\">\n    <view>\n      <view class=\"card\">\n        <view class=\"card-image\">\n          <view class=\"progress\">\n            {{ drawingStatus.progress ? drawingStatus.progress : '正在等待加入队列中' }}\n          </view>\n        </view>\n      </view>\n      <view class=\"tips\">\n        <view>离开当前页面创作不会受到任何影响</view>\n        <view>可在个人中心查看任务进度</view>\n      </view>\n    </view>\n    <SubmitButtonComponent title=\"完成后提醒我\" @onClick=\"handleSubscription\"/>\n  </view>\n</template>\n<script setup>\nimport SubmitButtonComponent from \"../../../components/submitButtonComponent.vue\";\nimport {onLoad} from '@dcloudio/uni-app'\nimport {ref, onUnmounted} from 'vue'\n\nimport env from \"../../../env\";\nimport BackPreviousComponent from \"../../../components/backPreviousComponent.vue\";\nimport store from \"@/store\";\nimport {reqGetTaskProgress} from \"@/api/drawingTask\";\n\nconst barTop = ref(0)\n\nconst barHeight = ref(0)\n\nconst drawingStatus = ref({\n  progress: '',\n  workflowsWorksId: undefined,\n})\n\nconst timer = ref(null)\n\nconst isInvoke = ref(false)\n\nconst handleGetDrawingProgress = async (taskId) => {\n  timer.value = setInterval(async () => {\n    if (!isInvoke.value) {\n      isInvoke.value = true\n      try {\n        let {data} = await reqGetTaskProgress(taskId);\n        const {progress, workflowsWorksId, status,location} = data\n        if (status === 'WAIT') {\n          drawingStatus.value.progress = '任务正在列队中,当前排在' + location + \"位\"\n          return\n        }\n        if (status === 'BUILD') {\n          if (progress === 99) {\n            drawingStatus.value.progress = '正在进行敏感检测'\n          } else {\n            drawingStatus.value.progress = progress + '%'\n          }\n          return\n        }\n        if (status === \"SUCCEED\") {\n          clearInterval(timer.value);\n          uni.$emit(\"WORKFLOWS_WORKS:REFRESH\")\n          uni.redirectTo({\n            url: '/pages/drawing/view/drawingPreviewView?workflowsWorksId=' + workflowsWorksId\n          })\n          return\n        }\n        if (status === \"FAILED\") {\n          uni.showToast({\n            title: '服务貌似出了点问题,请稍后再试',\n            icon: 'none',\n            duration: 2000\n          })\n          await store.dispatch('fetchUserInfo')\n          clearInterval(timer.value);\n          setTimeout(() => {\n            uni.navigateBack()\n          }, 1000)\n        }\n      } catch (e) {\n        clearInterval(timer.value);\n        uni.showToast({icon: 'none', duration: 1000, title: e.msg});\n        uni.navigateBack()\n      } finally {\n        isInvoke.value = false\n      }\n    }\n  }, 2000);\n}\n\nconst handleSubscription = async () => {\n\n  let tmplIds = env.tmplIds;\n  uni.requestSubscribeMessage({\n    tmplIds: tmplIds,\n    success: async function (res) {\n      if (res[tmplIds[0]] === 'accept') {\n        uni.showToast({\n          title: '作品生成完成后会以微信通知方式发送给您~',\n          icon: 'none',\n          duration: 2000\n        })\n      } else {\n        uni.showModal({\n          title: '订阅消息',\n          content: '您当前拒绝接收当前作品生成消息通知，是否去开启?',\n          confirmText: '开启授权',\n          confirmColor: '#345391',\n          cancelText: '仍然拒绝',\n          cancelColor: '#999999',\n          success: res => {\n            if (res.confirm) {\n              uni.openSetting({\n                success(res) {\n                  console.log(res)\n                },\n              })\n            }\n          }\n        })\n      }\n    }\n  })\n}\n\n\nonLoad((option) => {\n  let menuButtonBoundingClientRect = uni.getMenuButtonBoundingClientRect();\n  barTop.value = menuButtonBoundingClientRect.top\n  barHeight.value = menuButtonBoundingClientRect.height\n  handleGetDrawingProgress(option.taskId)\n})\n\nonUnmounted(() => {\n  clearInterval(timer.value)\n})\n</script>\n\n\n<style scoped lang=\"scss\">\n\n.container {\n  height: 100vh;\n  display: flex;\n  justify-content: center;\n  align-items: center\n}\n\n.tips {\n  text-align: center;\n  margin-top: 30rpx;\n  font-size: 26rpx\n}\n\n.tips > view:first-child {\n  color: #818181;\n  padding-top: 30rpx\n}\n\n.tips > view:last-child {\n  color: #afafaf;\n  padding-top: 20rpx\n}\n\n.progress {\n  color: white;\n  font-size: 40rpx\n}\n\n.card {\n  background: linear-gradient(120deg, rgb(243, 99, 101) 1%, rgb(162, 89, 244) 10.31%, rgb(248, 71, 149) 26.24%, rgb(184, 54, 189) 97.8%);;\n  animation: gradient 1s ease infinite;\n  background-size: 200% 200%;\n  padding: 5rpx;\n  border-radius: 25rpx;\n}\n\n.card-image {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  width: 700rpx;\n  height: 600rpx;\n  border-radius: 25rpx;\n}\n\n@keyframes gradient {\n  0% {\n    background-position: 0 12%;\n  }\n\n  50% {\n    background-position: 100% 100%;\n  }\n\n  100% {\n    background-position: 0 12%;\n  }\n}\n\n\n</style>\n","import MiniProgramPage from 'E:/0/beifen/0/0Files/2025答辩/ts-ts/miniProgram/pages/drawing/view/drawingExecutionView.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","reqGetTaskProgress","uni","store","env","res","onLoad","onUnmounted"],"mappings":"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"}