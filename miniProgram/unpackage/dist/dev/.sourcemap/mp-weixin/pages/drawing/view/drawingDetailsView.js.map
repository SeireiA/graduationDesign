{"version":3,"file":"drawingDetailsView.js","sources":["pages/drawing/view/drawingDetailsView.vue","D:/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvZHJhd2luZy92aWV3L2RyYXdpbmdEZXRhaWxzVmlldy52dWU"],"sourcesContent":["<script setup>\nimport {ref,nextTick} from 'vue'\nimport store from \"../../../store\";\nimport {onLoad} from '@dcloudio/uni-app'\nimport {conversionTime} from \"../../../utils/date\";\nimport LoadingPageComponent from \"../../../components/loadingPageComponent.vue\";\nimport BackPreviousComponent from \"../../../components/backPreviousComponent.vue\";\nimport LoadingDataComponent from \"../../../components/loadingDataComponent.vue\";\nimport EmptyDataComponent from \"../../../components/emptyDataComponent.vue\";\nimport TopButtonComponent from \"../../../components/topButtonComponent.vue\";\nimport {reqGetWorkflows} from \"@/api/drawingWorkflows\";\nimport {reqCreateComments, reqDeleteComments, reqGetCommentsPage} from \"@/api/drawingComments\";\n\nconst obj = ref({\n  title: '',\n  originalImage: '',\n  nowImage: '',\n  introduced: '',\n  visited: undefined,\n  createTime: '',\n})\n\nconst workflowsId = ref(undefined)\n\nconst isLoading = ref(true)\n\nconst isLoadingComments = ref(false)\n\nconst barTop = ref(0)\n\nconst barHeight = ref(0)\n\nconst pageNum = ref(1)\n\nconst comments = ref([])\n\nconst input = ref('')\n\nconst isTopButtonShow = ref(false)\n\nconst scrollTop = ref(0)\n\nconst contentTop = ref(0)\n\nconst handlePageScroll = ((e) => {\n  scrollTop.value = e.detail.scrollTop\n  isTopButtonShow.value = e.detail.scrollTop > 600;\n})\n\nconst handleBackToTop = () => {\n  contentTop.value = scrollTop.value\n  nextTick(() => {\n    contentTop.value = 0\n  })\n}\n\n\nconst handleToPage = (url) => {\n  if (!store.getters.userInfo) {\n    uni.reLaunch({\n      url: '/pages/user/user'\n    })\n    return\n  }\n  uni.navigateTo({\n    url: url,\n    animationType: 'pop-in',\n    animationDuration: 200\n  })\n}\n\nconst handleGetCommentsPage = async () => {\n  if (!isLoadingComments.value) {\n    try {\n      isLoadingComments.value = true\n      const {data} = await reqGetCommentsPage({\n        pageNum: pageNum.value,\n        workflowsId: workflowsId.value\n      });\n      if (data.records && data.records.length > 0) {\n        pageNum.value = pageNum.value + 1\n        comments.value.push(...data.records);\n      }\n    } catch (e) {\n      console.log(e)\n    } finally {\n      setTimeout(() => {\n        isLoadingComments.value = false\n      }, 500)\n    }\n  }\n}\n\nconst handleScrollToLower = () => {\n  handleGetCommentsPage()\n}\n\nconst handleGetWorkflows = async (id) => {\n  try {\n    isLoading.value = true\n    const {data} = await reqGetWorkflows(id)\n    obj.value = data\n  } catch (e) {\n    uni.showToast({icon: 'none', duration: 1000, title: e.msg});\n    uni.navigateBack()\n  } finally {\n    setTimeout(() => {\n      isLoading.value = false\n    }, 500)\n  }\n\n}\n\n\nconst handleSendComments = async () => {\n  if (!store.getters.userInfo) {\n    uni.reLaunch({\n      url: '/pages/user/user'\n    })\n    return\n  }\n  if (!input.value.trim()) {\n    uni.showToast({\n      title: '评论内容不能为空',\n      icon: 'none',\n      duration: 2000\n    })\n    return\n  }\n  try {\n    uni.showLoading({\n      title: '正在回复 ing~',\n      mask: true\n    });\n    await reqCreateComments({\n      content: input.value,\n      workflowsId: workflowsId.value\n    });\n    input.value = ''\n    pageNum.value = 1\n    comments.value = []\n    await handleGetCommentsPage()\n    uni.showToast({icon: 'none', duration: 3000, title: \"发送成功!长按自己发布的评论可以删除哦!\"});\n  } catch (e) {\n    console.log(e)\n  } finally {\n    setTimeout(() => {\n      uni.hideLoading()\n    }, 500)\n  }\n\n}\n\nconst handleDeleteComments = async (id, permissions, index) => {\n  if (permissions) {\n    uni.showModal({\n      title: '提示',\n      content: '确定删除这条评论？',\n      success: async function (res) {\n        if (res.confirm) {\n          uni.showLoading({\n            title: '正在删除 ing~',\n            mask: true\n          });\n          try {\n            await reqDeleteComments({\n              workflowsCommentsId: id\n            })\n            comments.value.splice(index, 1)\n            uni.hideLoading();\n            uni.showToast({\n              icon: 'none',\n              duration: 2000,\n              title: '删除成功'\n            });\n          } catch (e) {\n            console.log(e)\n          }\n        }\n      }\n    });\n  }\n}\n\nonLoad((option) => {\n  workflowsId.value = Number(option.workflowsId)\n  let menuButtonBoundingClientRect = uni.getMenuButtonBoundingClientRect();\n  barTop.value = menuButtonBoundingClientRect.top\n  barHeight.value = menuButtonBoundingClientRect.height\n  handleGetCommentsPage()\n  handleGetWorkflows(workflowsId.value)\n})\n\n</script>\n\n\n<template>\n  <view>\n    <TopButtonComponent :is-show=\"isTopButtonShow\" @click-top=\"handleBackToTop\"/>\n    <BackPreviousComponent :bar-height=\"barHeight\" :bar-top=\"barTop\"/>\n    <LoadingDataComponent v-if=\"isLoadingComments\" :top=\"200\"/>\n    <LoadingPageComponent v-if=\"isLoading\"/>\n    <scroll-view\n        scroll-y=\"true\"\n        class=\"scroll\"\n        scroll-with-animation=\"true\"\n        lower-threshold=\"100\"\n        v-show=\"!isLoading\"\n        @scrolltolower=\"handleScrollToLower()\"\n        :scrollTop=\"contentTop\"\n        @scroll=\"handlePageScroll\"\n    >\n      <view>\n        <view class=\"card-image\">\n          <view class=\"card-image-box\">\n            <image\n                mode=\"aspectFill\"\n                :src=\"obj.originalImage\"\n            />\n          </view>\n          <view class=\"card-image-box\">\n            <image\n                mode=\"aspectFill\"\n                :src=\"obj.nowImage\"\n            />\n          </view>\n          <view class=\"arrow\">\n            <image src=\"/static/icon/rightArrow.svg\"/>\n          </view>\n        </view>\n        <view class=\"textContainer\">\n          <view class=\"title\">{{ obj.title }}</view>\n          <view class=\"cardTextBox\">\n            <view class=\"cardTextBoxChild\">\n              <view>\n                <uni-icons type=\"paperplane\" size=\"30rpx\" color=\"#a6a6a6\"></uni-icons>\n                <view class=\"paddingLeft10\">发布于{{ conversionTime(obj.createTime) }}</view>\n              </view>\n              <view class=\"marginLeft20\">\n                <uni-icons type=\"star-filled\" size=\"30rpx\" color=\"#a6a6a6\"></uni-icons>\n                <view class=\"paddingLeft10\">{{ obj.visited }}人在玩</view>\n              </view>\n            </view>\n          </view>\n          <view class=\"introduced\">\n            {{\n              obj.introduced\n            }}\n          </view>\n          <view class=\"btn\" @click=\"handleToPage('/pages/drawing/view/drawingFormView?workflowsId=' + obj.workflowsId)\">\n            开始制作\n          </view>\n          <view class=\"driver\"/>\n          <view>\n            <view class=\"comments\">\n              <uni-icons type=\"chat\" size=\"55rpx\" color=\"white\"></uni-icons>\n              <view class=\"commentsText\">评论</view>\n            </view>\n            <view class=\"commentsInput\">\n              <view>\n                <image class=\"commentsAvatar\"\n                       :src=\"store.getters.userInfo &&  store.getters.userInfo.avatar  ? store.getters.userInfo.avatar  :'/static/avatar/default_user.png'\"/>\n              </view>\n              <view>\n                <input v-model=\"input\" placeholder=\"留下我的看法\" type=\"text\" class=\"commentsInputText\" maxlength=\"100\"\n                       confirm-type=\"send\" @confirm=\"handleSendComments\"/>\n              </view>\n              <view class=\"commentsSend\" @click=\"handleSendComments\">\n                发送\n              </view>\n            </view>\n            <view class=\"commentSection\" v-if=\"comments&&comments.length>0\">\n              <view class=\"commentView\" v-for=\"(item,index) in comments\" :key=\"index\"\n                    @longpress=\"handleDeleteComments(item.workflowsCommentsId,item.isCurrentUser,index)\">\n                <view>\n                  <image class=\"commentsAvatar\"\n                         :src=\"item.avatar  ?item.avatar  :'/static/avatar/default_user.png'\"/>\n                </view>\n                <view class=\"commentName\">\n                  <view>\n                    {{ item.nickName }}\n                  </view>\n                  <view class=\"commentContent\">\n                    {{ item.content }}\n                  </view>\n                  <view class=\"commentDate\">\n                    {{ conversionTime(item.createTime) }}\n                  </view>\n                </view>\n              </view>\n            </view>\n            <EmptyDataComponent :msg=\"'评论区空空如也'\" :height=\"30\" v-else/>\n          </view>\n        </view>\n      </view>\n    </scroll-view>\n  </view>\n</template>\n\n<style scoped lang=\"scss\">\n.comments {\n  display: flex;\n  align-items: center\n}\n\n.commentsText {\n  font-size: 35rpx;\n  padding-left: 10rpx\n}\n\n.commentSection {\n  margin-top: 70rpx;\n  margin-bottom: 100rpx\n}\n\n.commentView {\n  display: flex;\n  align-items: flex-start;\n  margin-top: 30rpx;\n  animation: slideEase 0.5s ease-in-out forwards;\n}\n\n.commentName {\n  padding-left: 20rpx;\n  color: #c8c8c8;\n  font-size: 28rpx\n}\n\n.commentContent {\n  padding-top: 25rpx;\n  color: #cacaca\n}\n\n.commentDate {\n  padding-top: 20rpx;\n  color: #867c7c;\n  font-size: 25rpx\n}\n\n.commentsInput {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding-top: 40rpx\n}\n\n.commentsAvatar {\n  border-radius: 100%;\n  width: 70rpx;\n  height: 70rpx\n}\n\n.commentsInputText {\n  font-size: 28rpx;\n  font-weight: normal;\n  border: 1rpx solid #3a3a3a;\n  background: #222423;\n  width: 380rpx;\n  padding: 15rpx;\n  border-radius: 10rpx\n}\n\n.commentsSend {\n  color: #9c9c9c;\n  background: #222423;\n  padding: 17rpx 45rpx;\n  border-radius: 10rpx;\n  font-size: 28rpx\n}\n\n.btn {\n  background: linear-gradient(120deg, rgb(250, 52, 54) 1%, rgb(186, 42, 107) 66.24%, rgb(184, 54, 189) 97.8%);;\n  animation: gradient 4s ease infinite;\n  background-size: 200% 200%;\n  padding: 30rpx;\n  border-radius: 20rpx;\n  color: white;\n  margin-top: 40rpx;\n  text-align: center;\n  font-size: 36rpx;\n  font-weight: bold;\n}\n\n@keyframes gradient {\n  0% {\n    background-position: 0 12%;\n  }\n\n  50% {\n    background-position: 100% 100%;\n  }\n\n  100% {\n    background-position: 0 12%;\n  }\n}\n\n.introduced {\n  margin-top: 20rpx;\n  font-size: 26rpx;\n  display: -webkit-box;\n  -webkit-line-clamp: 3;\n  -webkit-box-orient: vertical;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  height: 100rpx;\n  line-height: 1.4;\n\n}\n\n.title {\n  font-size: 46rpx\n}\n\n.driver {\n  width: 100%;\n  background: #393939;\n  height: 2rpx;\n  margin-top: 100rpx;\n  margin-bottom: 40rpx;\n}\n\n.textContainer {\n\n  padding: 40rpx;\n  color: white;\n}\n\n.card-image {\n  display: flex;\n  position: relative;\n  box-shadow: 0 -50px 30px -10px #161817 inset;\n}\n\n.card-image-box {\n  width: 50%;\n}\n\n.card-image-box image {\n  width: 100%;\n  height: 540rpx;\n  position: relative;\n  z-index: -3;\n  object-fit: cover;\n}\n\n.scroll {\n  height: 100vh;\n  flex-grow:1;\n  overflow-y:auto;\n}\n\n.arrow {\n  position: absolute;\n  top: 45%;\n  left: 47%;\n  z-index: 2\n}\n\n.arrow > image {\n  width: 50rpx;\n  height: 50rpx\n}\n\n.cardTextBox {\n  font-size: 26rpx;\n  margin-top: 60rpx;\n  color: #a6a6a6;\n  display: flex;\n  justify-content: space-between;\n  align-items: center\n}\n\n.cardTextBoxChild {\n  display: flex\n}\n\n.cardTextBoxChild > view {\n  display: flex;\n  align-items: center\n}\n\n.marginLeft20 {\n  margin-left: 20rpx\n}\n\n.paddingLeft10 {\n  padding-left: 10rpx\n}\n\n@keyframes slideEase {\n  0% {\n    transform: translateX(-100px);\n  }\n  100% {\n    transform: translateX(0);\n  }\n}\n</style>\n","import MiniProgramPage from 'E:/0/beifen/0/0Files/2025答辩/ts-ts/miniProgram/pages/drawing/view/drawingDetailsView.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","nextTick","store","uni","reqGetCommentsPage","reqGetWorkflows","reqCreateComments","reqDeleteComments","onLoad"],"mappings":"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"}