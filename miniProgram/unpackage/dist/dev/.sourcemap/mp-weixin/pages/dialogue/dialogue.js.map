{"version":3,"file":"dialogue.js","sources":["pages/dialogue/dialogue.vue","D:/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvZGlhbG9ndWUvZGlhbG9ndWUudnVl"],"sourcesContent":["<template>\n  <view>\n\t  <view class=\"body\" v-show=\"store.getters.disguiseStatus\">\n\t    <!--    导航-->\n\t    <navigation-component/>\n\t    <!--    区分显示内容-->\n\t    <view class=\"view-container\">\n\t      <chat-component ref=\"chatRef\"/>\n\t    </view>\n\t    <!--    新建对话-->\n\t    <levitation-component @new-chat-topic=\"newChatTopic\"/>\n\t  </view>\n\t  <DialogueDisguiseComponent v-show=\"!(store.getters.disguiseStatus)\"/>\n  </view>\n</template>\n\n<script setup>\nimport {ref} from 'vue'\n\nimport ChatComponent from \"/pages/dialogue/component/chatComponent\";\nimport store from \"/store\";\nimport {reqGetModelList} from \"/api/chatConfig\";\nimport {onLoad, onUnload} from '@dcloudio/uni-app'\nimport LevitationComponent from \"/pages/dialogue/component/levitationComponent.vue\";\nimport {getChatTopic, setChatTopic} from \"/store/chatTopic\";\nimport {getTokenValue} from \"/store/token\";\nimport NavigationComponent from \"./component/navigationComponent.vue\";\nimport DialogueDisguiseComponent from \"@/components/disguise/dialogueDisguiseComponent.vue\";\n\nconst chatRef = ref(null)\n\nconst newChatTopic = () => {\n  uni.vibrateShort()\n  if (getTokenValue()) {\n    const chatTopic = getChatTopic();\n    const {index, array} = chatTopic\n    const arrayElement = array[index];\n    if (arrayElement.content.length <= 0) {\n      uni.showToast({icon: 'none', duration: 3000, title: \"当前已经是最新会话了\"});\n    } else {\n      let now = new Date();\n      let year = now.getFullYear(); // 获取当前年份\n      let month = now.getMonth() + 1; // 获取当前月份，注意getMonth()返回的月份是从0开始的，所以需要加1\n      let date = now.getDate(); // 获取当前日期\n\n      month = month.toString().padStart(2, '0');\n      date = date.toString().padStart(2, '0');\n\n      let hours = now.getHours(); // 获取当前小时\n      let minutes = now.getMinutes(); // 获取当前分钟\n\n\n      hours = hours.toString().padStart(2, '0');\n      minutes = minutes.toString().padStart(2, '0');\n\n\n      let currentTime = hours + ':' + minutes;\n      const id = generateRandom();\n      chatTopic.array.unshift({\n        id: id,\n        title: '',\n        date: year + '-' + month + '-' + date,\n        time: currentTime,\n        content: []\n      })\n      chatRef.value.html([])\n      setChatTopic(chatTopic)\n    }\n  } else {\n    uni.reLaunch({\n      url: '/pages/user/user'\n    })\n\n  }\n}\n\nconst generateRandom = () => {\n  const characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\n  let result = '';\n  const charactersLength = characters.length;\n  for (let i = 0; i < 12; i++) {\n    result += characters.charAt(Math.floor(Math.random() * charactersLength));\n  }\n  return result;\n}\n\nconst templateHTML = (data) => {\n  chatRef.value.html(data)\n}\n\nconst init = async () => {\n  if (!store.getters.userSetting) {\n    try {\n      const {data} = await reqGetModelList();\n      store.commit(\"setUserSetting\", {\n        model: data[0].model\n      });\n    } catch (e) {\n      uni.showToast({icon: 'none', duration: 3000, title: \"初始化用户数据失败\"});\n    }\n  }\n  if (!getTokenValue()) {\n    return\n  }\n  const chatTopic = getChatTopic();\n  if (!chatTopic) {\n    let now = new Date();\n    let year = now.getFullYear(); // 获取当前年份\n    let month = now.getMonth() + 1; // 获取当前月份，注意getMonth()返回的月份是从0开始的，所以需要加1\n    let date = now.getDate(); // 获取当前日期\n\n    month = month.toString().padStart(2, '0');\n    date = date.toString().padStart(2, '0');\n\n    let hours = now.getHours(); // 获取当前小时\n    let minutes = now.getMinutes(); // 获取当前分钟\n\n\n    hours = hours.toString().padStart(2, '0');\n    minutes = minutes.toString().padStart(2, '0');\n\n\n    let currentTime = hours + ':' + minutes;\n    const id = generateRandom();\n    setChatTopic({\n      index: 0,\n      array: [\n        {\n          id: id,\n          title: '',\n          date: year + '-' + month + '-' + date,\n          time: currentTime,\n          content: []\n        }\n      ]\n    })\n  } else {\n    const {index, array} = chatTopic\n    const arrayElement = array[index];\n    setTimeout(() => {\n      templateHTML(arrayElement.content)\n    }, 500)\n  }\n\n}\n\n\nonLoad(() => {\n  //初始化\n  init()\n  //构建函数\n  uni.$on('dialogue_template_html', function (data) {\n    templateHTML(data)\n  })\n})\n\nonUnload(() => {\n  uni.$off('dialogue_template_html')\n})\n\n</script>\n\n\n<style scoped lang=\"scss\">\n.body {\n  padding: 30rpx;\n}\n\n.view-container {\n  color: white;\n  padding-top: 10vh;\n  flex-direction: column;\n  flex: 1;\n}\n\n</style>\n","import MiniProgramPage from 'E:/0/beifen/0/0Files/2025答辩/ts-ts/miniProgram/pages/dialogue/dialogue.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","uni","getTokenValue","getChatTopic","setChatTopic","store","reqGetModelList","onLoad","onUnload"],"mappings":"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"}