{"version":3,"file":"index.js","sources":["components/mp-html/components/mp-html/highlight/index.js"],"sourcesContent":["/**\n * @fileoverview highlight 插件\n * Include prismjs (https://prismjs.com)\n */\nimport prism from './prism.min'\nimport config from './config'\nimport Parser from '../parser'\n\nfunction Highlight (vm) {\n  this.vm = vm\n}\n\nHighlight.prototype.onParse = function (node, vm) {\n  if (node.name === 'pre') {\n    if (vm.options.editable) {\n      node.attrs.class = (node.attrs.class || '') + ' hl-pre'\n      return\n    }\n    let i\n    for (i = node.children.length; i--;) {\n      if (node.children[i].name === 'code') break\n    }\n    if (i === -1) return\n    const code = node.children[i]\n    let className = code.attrs.class + ' ' + node.attrs.class\n    i = className.indexOf('language-')\n    if (i === -1) {\n      i = className.indexOf('lang-')\n      if (i === -1) {\n        className = 'language-text'\n        i = 9\n      } else {\n        i += 5\n      }\n    } else {\n      i += 9\n    }\n    let j\n    for (j = i; j < className.length; j++) {\n      if (className[j] === ' ') break\n    }\n    const lang = className.substring(i, j)\n    if (code.children.length) {\n      const text = this.vm.getText(code.children).replace(/&amp;/g, '&')\n      if (!text) return\n      if (node.c) {\n        node.c = undefined\n      }\n      if (prism.languages[lang]) {\n        code.children = (new Parser(this.vm).parse(\n          // 加一层 pre 保留空白符\n          '<pre>' + prism.highlight(text, prism.languages[lang], lang).replace(/token /g, 'hl-') + '</pre>'))[0].children\n      }\n      node.attrs.class = 'hl-pre'\n      code.attrs.class = 'hl-code'\n      if (config.showLanguageName) {\n        node.children.push({\n          name: 'div',\n          attrs: {\n            class: 'hl-language',\n            style: 'user-select:none'\n          },\n          children: [{\n            type: 'text',\n            text: lang\n          }]\n        })\n      }\n      if (config.copyByLongPress) {\n        node.attrs.style += (node.attrs.style || '') + ';user-select:none'\n        node.attrs['data-content'] = text\n        vm.expose()\n      }\n      if (config.showLineNumber) {\n        const line = text.split('\\n').length; const children = []\n        for (let k = line; k--;) {\n          children.push({\n            name: 'span',\n            attrs: {\n              class: 'span'\n            }\n          })\n        }\n        node.children.push({\n          name: 'span',\n          attrs: {\n            class: 'line-numbers-rows'\n          },\n          children\n        })\n      }\n    }\n  }\n}\n\nexport default Highlight\n"],"names":["prism","Parser"],"mappings":";;;AAQA,SAAS,UAAW,IAAI;AACtB,OAAK,KAAK;AACZ;AAEA,UAAU,UAAU,UAAU,SAAU,MAAM,IAAI;AAChD,MAAI,KAAK,SAAS,OAAO;AACvB,QAAI,GAAG,QAAQ,UAAU;AACvB,WAAK,MAAM,SAAS,KAAK,MAAM,SAAS,MAAM;AAC9C;AAAA,IACD;AACD,QAAI;AACJ,SAAK,IAAI,KAAK,SAAS,QAAQ,OAAM;AACnC,UAAI,KAAK,SAAS,CAAC,EAAE,SAAS;AAAQ;AAAA,IACvC;AACD,QAAI,MAAM;AAAI;AACd,UAAM,OAAO,KAAK,SAAS,CAAC;AAC5B,QAAI,YAAY,KAAK,MAAM,QAAQ,MAAM,KAAK,MAAM;AACpD,QAAI,UAAU,QAAQ,WAAW;AACjC,QAAI,MAAM,IAAI;AACZ,UAAI,UAAU,QAAQ,OAAO;AAC7B,UAAI,MAAM,IAAI;AACZ,oBAAY;AACZ,YAAI;AAAA,MACZ,OAAa;AACL,aAAK;AAAA,MACN;AAAA,IACP,OAAW;AACL,WAAK;AAAA,IACN;AACD,QAAI;AACJ,SAAK,IAAI,GAAG,IAAI,UAAU,QAAQ,KAAK;AACrC,UAAI,UAAU,CAAC,MAAM;AAAK;AAAA,IAC3B;AACD,UAAM,OAAO,UAAU,UAAU,GAAG,CAAC;AACrC,QAAI,KAAK,SAAS,QAAQ;AACxB,YAAM,OAAO,KAAK,GAAG,QAAQ,KAAK,QAAQ,EAAE,QAAQ,UAAU,GAAG;AACjE,UAAI,CAAC;AAAM;AACX,UAAI,KAAK,GAAG;AACV,aAAK,IAAI;AAAA,MACV;AACD,UAAIA,wDAAK,MAAC,UAAU,IAAI,GAAG;AACzB,aAAK,WAAY,IAAIC,2CAAM,OAAC,KAAK,EAAE,EAAE;AAAA;AAAA,UAEnC,UAAUD,wDAAK,MAAC,UAAU,MAAMA,wDAAK,MAAC,UAAU,IAAI,GAAG,IAAI,EAAE,QAAQ,WAAW,KAAK,IAAI;AAAA,QAAQ,EAAG,CAAC,EAAE;AAAA,MAC1G;AACD,WAAK,MAAM,QAAQ;AACnB,WAAK,MAAM,QAAQ;AACU;AAC3B,aAAK,SAAS,KAAK;AAAA,UACjB,MAAM;AAAA,UACN,OAAO;AAAA,YACL,OAAO;AAAA,YACP,OAAO;AAAA,UACR;AAAA,UACD,UAAU,CAAC;AAAA,YACT,MAAM;AAAA,YACN,MAAM;AAAA,UAClB,CAAW;AAAA,QACX,CAAS;AAAA,MACF;AAC2B;AAC1B,aAAK,MAAM,UAAU,KAAK,MAAM,SAAS,MAAM;AAC/C,aAAK,MAAM,cAAc,IAAI;AAC7B,WAAG,OAAQ;AAAA,MACZ;AAC0B;AACzB,cAAM,OAAO,KAAK,MAAM,IAAI,EAAE;AAAQ,cAAM,WAAW,CAAE;AACzD,iBAAS,IAAI,MAAM,OAAM;AACvB,mBAAS,KAAK;AAAA,YACZ,MAAM;AAAA,YACN,OAAO;AAAA,cACL,OAAO;AAAA,YACR;AAAA,UACb,CAAW;AAAA,QACF;AACD,aAAK,SAAS,KAAK;AAAA,UACjB,MAAM;AAAA,UACN,OAAO;AAAA,YACL,OAAO;AAAA,UACR;AAAA,UACD;AAAA,QACV,CAAS;AAAA,MACF;AAAA,IACF;AAAA,EACF;AACH;;"}