{"version":3,"file":"parser.js","sources":["components/mp-html/components/mp-html/style/parser.js"],"sourcesContent":["const blank = {\n  ' ': true,\n  '\\n': true,\n  '\\t': true,\n  '\\r': true,\n  '\\f': true\n}\n\nfunction Parser () {\n  this.styles = []\n  this.selectors = []\n}\n\n/**\n * @description 解析 css 字符串\n * @param {string} content css 内容\n */\nParser.prototype.parse = function (content) {\n  new Lexer(this).parse(content)\n  return this.styles\n}\n\n/**\n * @description 解析到一个选择器\n * @param {string} name 名称\n */\nParser.prototype.onSelector = function (name) {\n  // 不支持的选择器\n  if (name.includes('[') || name.includes('*') || name.includes('@')) return\n  const selector = {}\n  // 伪类\n  if (name.includes(':')) {\n    const info = name.split(':')\n    const pseudo = info.pop()\n    if (pseudo === 'before' || pseudo === 'after') {\n      selector.pseudo = pseudo\n      name = info[0]\n    } else return\n  }\n\n  // 分割交集选择器\n  function splitItem (str) {\n    const arr = []\n    let i, start\n    for (i = 1, start = 0; i < str.length; i++) {\n      if (str[i] === '.' || str[i] === '#') {\n        arr.push(str.substring(start, i))\n        start = i\n      }\n    }\n    if (!arr.length) {\n      return str\n    } else {\n      arr.push(str.substring(start, i))\n      return arr\n    }\n  }\n\n  // 后代选择器\n  if (name.includes(' ')) {\n    selector.list = []\n    const list = name.split(' ')\n    for (let i = 0; i < list.length; i++) {\n      if (list[i].length) {\n        // 拆分子选择器\n        const arr = list[i].split('>')\n        for (let j = 0; j < arr.length; j++) {\n          selector.list.push(splitItem(arr[j]))\n          if (j < arr.length - 1) {\n            selector.list.push('>')\n          }\n        }\n      }\n    }\n  } else {\n    selector.key = splitItem(name)\n  }\n\n  this.selectors.push(selector)\n}\n\n/**\n * @description 解析到选择器内容\n * @param {string} content 内容\n */\nParser.prototype.onContent = function (content) {\n  // 并集选择器\n  for (let i = 0; i < this.selectors.length; i++) {\n    this.selectors[i].style = content\n  }\n  this.styles = this.styles.concat(this.selectors)\n  this.selectors = []\n}\n\n/**\n * @description css 词法分析器\n * @param {object} handler 高层处理器\n */\nfunction Lexer (handler) {\n  this.selector = ''\n  this.style = ''\n  this.handler = handler\n}\n\nLexer.prototype.parse = function (content) {\n  this.i = 0\n  this.content = content\n  this.state = this.blank\n  for (let len = content.length; this.i < len; this.i++) {\n    this.state(content[this.i])\n  }\n}\n\nLexer.prototype.comment = function () {\n  this.i = this.content.indexOf('*/', this.i) + 1\n  if (!this.i) {\n    this.i = this.content.length\n  }\n}\n\nLexer.prototype.blank = function (c) {\n  if (!blank[c]) {\n    if (c === '/' && this.content[this.i + 1] === '*') {\n      this.comment()\n      return\n    }\n    this.selector += c\n    this.state = this.name\n  }\n}\n\nLexer.prototype.name = function (c) {\n  if (c === '/' && this.content[this.i + 1] === '*') {\n    this.comment()\n    return\n  }\n  if (c === '{' || c === ',' || c === ';') {\n    this.handler.onSelector(this.selector.trimEnd())\n    this.selector = ''\n    if (c !== '{') {\n      while (blank[this.content[++this.i]]);\n    }\n    if (this.content[this.i] === '{') {\n      this.floor = 1\n      this.state = this.val\n    } else {\n      this.selector += this.content[this.i]\n    }\n  } else if (blank[c]) {\n    this.selector += ' '\n  } else {\n    this.selector += c\n  }\n}\n\nLexer.prototype.val = function (c) {\n  if (c === '/' && this.content[this.i + 1] === '*') {\n    this.comment()\n    return\n  }\n  if (c === '{') {\n    this.floor++\n  } else if (c === '}') {\n    this.floor--\n    if (!this.floor) {\n      this.handler.onContent(this.style)\n      this.style = ''\n      this.state = this.blank\n      return\n    }\n  }\n  this.style += c\n}\n\nexport default Parser\n"],"names":[],"mappings":"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"}