{"version":3,"file":"index.js","sources":["components/mp-html/components/mp-html/editable/index.js"],"sourcesContent":["/**\n * @fileoverview editable 插件\n */\nimport config from './config'\nimport Parser from '../parser'\n\nfunction Editable (vm) {\n  this.vm = vm\n  this.editHistory = [] // 历史记录\n  this.editI = -1 // 历史记录指针\n  vm._mask = [] // 蒙版被点击时进行的操作\n\n  vm._setData = function (path, val) {\n    const paths = path.split('.')\n    let target = vm\n    for (let i = 0; i < paths.length - 1; i++) {\n      target = target[paths[i]]\n    }\n    vm.$set(target, paths.pop(), val)\n  }\n\n  /**\n   * @description 移动历史记录指针\n   * @param {Number} num 移动距离\n   */\n  const move = num => {\n    setTimeout(() => {\n      const item = this.editHistory[this.editI + num]\n      if (item) {\n        this.editI += num\n        vm._setData(item.key, item.value)\n      }\n    }, 200)\n  }\n  vm.undo = () => move(-1) // 撤销\n  vm.redo = () => move(1) // 重做\n\n  /**\n   * @description 更新记录\n   * @param {String} path 更新内容路径\n   * @param {*} oldVal 旧值\n   * @param {*} newVal 新值\n   * @param {Boolean} set 是否更新到视图\n   * @private\n   */\n  vm._editVal = (path, oldVal, newVal, set) => {\n    // 当前指针后的内容去除\n    while (this.editI < this.editHistory.length - 1) {\n      this.editHistory.pop()\n    }\n\n    // 最多存储 30 条操作记录\n    while (this.editHistory.length > 30) {\n      this.editHistory.pop()\n      this.editI--\n    }\n\n    const last = this.editHistory[this.editHistory.length - 1]\n    if (!last || last.key !== path) {\n      if (last) {\n        // 去掉上一次的新值\n        this.editHistory.pop()\n        this.editI--\n      }\n      // 存入这一次的旧值\n      this.editHistory.push({\n        key: path,\n        value: oldVal\n      })\n      this.editI++\n    }\n\n    // 存入本次的新值\n    this.editHistory.push({\n      key: path,\n      value: newVal\n    })\n    this.editI++\n\n    // 更新到视图\n    if (set) {\n      vm._setData(path, newVal)\n    }\n  }\n\n  /**\n   * @description 获取菜单项\n   * @private\n   */\n  vm._getItem = function (node, up, down) {\n    let items\n    let i\n    if (node === 'color') {\n      return config.color\n    }\n    if (node.name === 'img') {\n      items = config.img.slice(0)\n      if (!vm.getSrc) {\n        i = items.indexOf('换图')\n        if (i !== -1) {\n          items.splice(i, 1)\n        }\n        i = items.indexOf('超链接')\n        if (i !== -1) {\n          items.splice(i, 1)\n        }\n        i = items.indexOf('预览图')\n        if (i !== -1) {\n          items.splice(i, 1)\n        }\n      }\n      i = items.indexOf('禁用预览')\n      if (i !== -1 && node.attrs.ignore) {\n        items[i] = '启用预览'\n      }\n    } else if (node.name === 'a') {\n      items = config.link.slice(0)\n      if (!vm.getSrc) {\n        i = items.indexOf('更换链接')\n        if (i !== -1) {\n          items.splice(i, 1)\n        }\n      }\n    } else if (node.name === 'video' || node.name === 'audio') {\n      items = config.media.slice(0)\n      i = items.indexOf('封面')\n      if (!vm.getSrc && i !== -1) {\n        items.splice(i, 1)\n      }\n      i = items.indexOf('循环')\n      if (node.attrs.loop && i !== -1) {\n        items[i] = '不循环'\n      }\n      i = items.indexOf('自动播放')\n      if (node.attrs.autoplay && i !== -1) {\n        items[i] = '不自动播放'\n      }\n    } else if (node.name === 'card') {\n      items = config.card.slice(0)\n    } else {\n      items = config.node.slice(0)\n    }\n    if (!up) {\n      i = items.indexOf('上移')\n      if (i !== -1) {\n        items.splice(i, 1)\n      }\n    }\n    if (!down) {\n      i = items.indexOf('下移')\n      if (i !== -1) {\n        items.splice(i, 1)\n      }\n    }\n    return items\n  }\n\n  /**\n   * @description 显示 tooltip\n   * @param {object} obj\n   * @private\n   */\n  vm._tooltip = function (obj) {\n    vm.$set(vm, 'tooltip', {\n      top: obj.top,\n      items: obj.items\n    })\n    vm._tooltipcb = obj.success\n  }\n\n  /**\n   * @description 显示滚动条\n   * @param {object} obj\n   * @private\n   */\n  vm._slider = function (obj) {\n    vm.$set(vm, 'slider', {\n      min: obj.min,\n      max: obj.max,\n      value: obj.value,\n      top: obj.top\n    })\n    vm._slideringcb = obj.changing\n    vm._slidercb = obj.change\n  }\n\n  /**\n   * @description 显示颜色选择\n   * @param {object} obj\n   * @private\n   */\n  vm._color = function (obj) {\n    vm.$set(vm, 'color', {\n      items: obj.items,\n      top: obj.top\n    })\n    vm._colorcb = obj.success\n  }\n\n  /**\n   * @description 点击蒙版\n   * @private\n   */\n  vm._maskTap = function () {\n    // 隐藏所有悬浮窗\n    while (vm._mask.length) {\n      (vm._mask.pop())()\n    }\n    if (vm.tooltip) {\n      vm.$set(vm, 'tooltip', null)\n    }\n    if (vm.slider) {\n      vm.$set(vm, 'slider', null)\n    }\n    if (vm.color) {\n      vm.$set(vm, 'color', null)\n    }\n  }\n\n  /**\n   * @description 插入节点\n   * @param {Object} node\n   */\n  function insert (node) {\n    if (vm._edit) {\n      vm._edit.insert(node)\n    } else {\n      const nodes = vm.nodes.slice(0)\n      nodes.push(node)\n      vm._editVal('nodes', vm.nodes, nodes, true)\n    }\n  }\n\n  /**\n   * @description 在光标处插入指定 html 内容\n   * @param {String} html 内容\n   */\n  vm.insertHtml = html => {\n    this.inserting = true\n    const arr = new Parser(vm).parse(html)\n    this.inserting = undefined\n    for (let i = 0; i < arr.length; i++) {\n      insert(arr[i])\n    }\n  }\n\n  /**\n   * @description 在光标处插入图片\n   */\n  vm.insertImg = function () {\n    vm.getSrc && vm.getSrc('img').then(src => {\n      if (typeof src === 'string') {\n        src = [src]\n      }\n      const parser = new Parser(vm)\n      for (let i = 0; i < src.length; i++) {\n        insert({\n          name: 'img',\n          attrs: {\n            src: parser.getUrl(src[i])\n          }\n        })\n      }\n    }).catch(() => { })\n  }\n\n  /**\n   * @description 在光标处插入一个链接\n   */\n  vm.insertLink = function () {\n    vm.getSrc && vm.getSrc('link').then(url => {\n      insert({\n        name: 'a',\n        attrs: {\n          href: url\n        },\n        children: [{\n          type: 'text',\n          text: url\n        }]\n      })\n    }).catch(() => { })\n  }\n\n  /**\n   * @description 在光标处插入一个表格\n   * @param {Number} rows 行数\n   * @param {Number} cols 列数\n   */\n  vm.insertTable = function (rows, cols) {\n    const table = {\n      name: 'table',\n      attrs: {\n        style: 'display:table;width:100%;margin:10px 0;text-align:center;border-spacing:0;border-collapse:collapse;border:1px solid gray'\n      },\n      children: []\n    }\n    for (let i = 0; i < rows; i++) {\n      const tr = {\n        name: 'tr',\n        attrs: {},\n        children: []\n      }\n      for (let j = 0; j < cols; j++) {\n        tr.children.push({\n          name: 'td',\n          attrs: {\n            style: 'padding:2px;border:1px solid gray'\n          },\n          children: [{\n            type: 'text',\n            text: ''\n          }]\n        })\n      }\n      table.children.push(tr)\n    }\n    insert(table)\n  }\n\n  /**\n   * @description 插入视频/音频\n   * @param {Object} node\n   */\n  function insertMedia (node) {\n    if (typeof node.src === 'string') {\n      node.src = [node.src]\n    }\n    const parser = new Parser(vm)\n    // 拼接主域名\n    for (let i = 0; i < node.src.length; i++) {\n      node.src[i] = parser.getUrl(node.src[i])\n    }\n    insert({\n      name: 'div',\n      attrs: {\n        style: 'text-align:center'\n      },\n      children: [node]\n    })\n  }\n\n  /**\n   * @description 在光标处插入一个视频\n   */\n  vm.insertVideo = function () {\n    vm.getSrc && vm.getSrc('video').then(src => {\n      insertMedia({\n        name: 'video',\n        attrs: {\n          controls: 'T'\n        },\n        children: [],\n        src,\n        // #ifdef APP-PLUS\n        html: `<video src=\"${src}\" style=\"width:100%;height:100%\"></video>`\n        // #endif\n      })\n    }).catch(() => { })\n  }\n\n  /**\n   * @description 在光标处插入一个音频\n   */\n  vm.insertAudio = function () {\n    vm.getSrc && vm.getSrc('audio').then(attrs => {\n      let src\n      if (attrs.src) {\n        src = attrs.src\n        attrs.src = undefined\n      } else {\n        src = attrs\n        attrs = {}\n      }\n      attrs.controls = 'T'\n      insertMedia({\n        name: 'audio',\n        attrs,\n        children: [],\n        src\n      })\n    }).catch(() => { })\n  }\n\n  /**\n   * @description 在光标处插入一段文本\n   */\n  vm.insertText = function () {\n    insert({\n      name: 'p',\n      attrs: {},\n      children: [{\n        type: 'text',\n        text: ''\n      }]\n    })\n  }\n\n  /**\n   * @description 清空内容\n   */\n  vm.clear = function () {\n    vm._maskTap()\n    vm._edit = undefined\n    vm.$set(vm, 'nodes', [{\n      name: 'p',\n      attrs: {},\n      children: [{\n        type: 'text',\n        text: ''\n      }]\n    }])\n  }\n\n  /**\n   * @description 获取编辑后的 html\n   */\n  vm.getContent = function () {\n    let html = '';\n    // 递归遍历获取\n    (function traversal (nodes, table) {\n      for (let i = 0; i < nodes.length; i++) {\n        let item = nodes[i]\n        if (item.type === 'text') {\n          html += item.text.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/\\n/g, '<br>').replace(/\\xa0/g, '&nbsp;') // 编码实体\n        } else {\n          if (item.name === 'img') {\n            item.attrs.i = ''\n            // 还原被转换的 svg\n            if ((item.attrs.src || '').includes('data:image/svg+xml;utf8,')) {\n              html += item.attrs.src.substr(24).replace(/%23/g, '#').replace('<svg', '<svg style=\"' + (item.attrs.style || '') + '\"')\n              continue\n            }\n          } else if (item.name === 'video' || item.name === 'audio') {\n            // 还原 video 和 audio 的 source\n            item = JSON.parse(JSON.stringify(item))\n            if (item.src.length > 1) {\n              item.children = []\n              for (let j = 0; j < item.src.length; j++) {\n                item.children.push({\n                  name: 'source',\n                  attrs: {\n                    src: item.src[j]\n                  }\n                })\n              }\n            } else {\n              item.attrs.src = item.src[0]\n            }\n          } else if (item.name === 'div' && (item.attrs.style || '').includes('overflow:auto') && (item.children[0] || {}).name === 'table') {\n            // 还原滚动层\n            item = item.children[0]\n          }\n          // 还原 table\n          if (item.name === 'table') {\n            item = JSON.parse(JSON.stringify(item))\n            table = item.attrs\n            if ((item.attrs.style || '').includes('display:grid')) {\n              item.attrs.style = item.attrs.style.split('display:grid')[0]\n              const children = [{\n                name: 'tr',\n                attrs: {},\n                children: []\n              }]\n              for (let j = 0; j < item.children.length; j++) {\n                item.children[j].attrs.style = item.children[j].attrs.style.replace(/grid-[^;]+;*/g, '')\n                if (item.children[j].r !== children.length) {\n                  children.push({\n                    name: 'tr',\n                    attrs: {},\n                    children: [item.children[j]]\n                  })\n                } else {\n                  children[children.length - 1].children.push(item.children[j])\n                }\n              }\n              item.children = children\n            }\n          }\n          html += '<' + item.name\n          for (const attr in item.attrs) {\n            let val = item.attrs[attr]\n            if (!val) continue\n            if (val === 'T' || val === true) {\n              // bool 型省略值\n              html += ' ' + attr\n              continue\n            } else if (item.name[0] === 't' && attr === 'style' && table) {\n              // 取消为了显示 table 添加的 style\n              val = val.replace(/;*display:table[^;]*/, '')\n              if (table.border) {\n                val = val.replace(/border[^;]+;*/g, $ => $.includes('collapse') ? $ : '')\n              }\n              if (table.cellpadding) {\n                val = val.replace(/padding[^;]+;*/g, '')\n              }\n              if (!val) continue\n            }\n            html += ' ' + attr + '=\"' + val.replace(/\"/g, '&quot;') + '\"'\n          }\n          html += '>'\n          if (item.children) {\n            traversal(item.children, table)\n            html += '</' + item.name + '>'\n          }\n        }\n      }\n    })(vm.nodes)\n\n    // 其他插件处理\n    for (let i = vm.plugins.length; i--;) {\n      if (vm.plugins[i].onGetContent) {\n        html = vm.plugins[i].onGetContent(html) || html\n      }\n    }\n\n    return html\n  }\n}\n\nEditable.prototype.onUpdate = function (content, config) {\n  if (this.vm.editable) {\n    this.vm._maskTap()\n    config.entities.amp = '&'\n    if (!this.inserting) {\n      this.vm._edit = undefined\n      if (!content) {\n        setTimeout(() => {\n          this.vm.$set(this.vm, 'nodes', [{\n            name: 'p',\n            attrs: {},\n            children: [{\n              type: 'text',\n              text: ''\n            }]\n          }])\n        }, 0)\n      }\n    }\n  }\n}\n\nEditable.prototype.onParse = function (node) {\n  // 空白单元格可编辑\n  if (this.vm.editable && (node.name === 'td' || node.name === 'th') && !this.vm.getText(node.children)) {\n    node.children.push({\n      type: 'text',\n      text: ''\n    })\n  }\n}\n\nexport default Editable\n"],"names":["config","Parser"],"mappings":"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"}